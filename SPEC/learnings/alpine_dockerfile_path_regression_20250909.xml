<?xml version="1.0" encoding="UTF-8"?>
<learnings>
    <learning_entry date="2025-09-09" type="regression_fix">
        <title>Alpine Dockerfile Path Regression in GCP Deployment Script</title>
        
        <problem>
            <description>Deployment script deploy_to_gcp.py was looking for Alpine Dockerfiles in wrong directory</description>
            <context>When attempting to deploy backend to staging with Alpine containers, script failed with FileNotFoundError</context>
            <error_message>[Errno 2] No such file or directory: 'docker/backend.staging.alpine.Dockerfile'</error_message>
            <impact>Prevented Alpine-optimized deployments to GCP staging environment</impact>
        </problem>
        
        <discovery_process>
            <step>Initial attempt to deploy failed with missing Dockerfile error</step>
            <step>Incorrectly attempted to create new Docker directory and Alpine Dockerfiles</step>
            <step>User correctly identified this as regression - Alpine files should already exist</step>
            <step>Used Grep to search for existing Alpine Dockerfiles: found them in dockerfiles/ directory</step>
            <step>Confirmed existing Alpine files are comprehensive and production-ready</step>
        </discovery_process>
        
        <root_cause>
            <analysis>Deployment script was hardcoded to look for Alpine Dockerfiles in 'docker/' directory but they actually exist in 'dockerfiles/' directory</analysis>
            <incorrect_paths>
                - docker/backend.staging.alpine.Dockerfile
                - docker/auth.staging.alpine.Dockerfile  
                - docker/frontend.staging.alpine.Dockerfile
            </incorrect_paths>
            <correct_paths>
                - dockerfiles/backend.staging.alpine.Dockerfile
                - dockerfiles/auth.staging.alpine.Dockerfile
                - dockerfiles/frontend.staging.alpine.Dockerfile
            </correct_paths>
        </root_cause>
        
        <solution>
            <action>Updated scripts/deploy_to_gcp.py to use correct dockerfiles/ paths</action>
            <files_modified>
                <file>scripts/deploy_to_gcp.py</file>
                <changes>
                    <change line="86">Fixed backend_dockerfile path</change>
                    <change line="129">Fixed auth dockerfile path</change>
                    <change line="159">Fixed frontend dockerfile path</change>
                </changes>
            </files_modified>
        </solution>
        
        <prevention>
            <patterns>Always search for existing files before creating new ones</patterns>
            <validation>When file paths fail, use Grep/Glob to find actual location</validation>
            <testing>Test Alpine deployment paths in development before staging</testing>
        </prevention>
        
        <business_impact>
            <cost_savings>Alpine containers provide 78% size reduction and 68% cost savings</cost_savings>
            <performance>3x faster startup times critical for Cloud Run scaling</performance>
            <reliability>Production-ready Alpine Dockerfiles with proper security and optimization</reliability>
        </business_impact>
    </learning_entry>
</learnings>