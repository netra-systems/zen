
âš ï¸ NOTE: Using Cloud Build (slow). Consider using --build-local for 5-10x faster builds.
   Example: python scripts/deploy_to_gcp.py --project netra-staging --build-local


ğŸš€ Using Alpine-optimized images (default):
   â€¢ 78% smaller images (150MB vs 350MB)
   â€¢ 3x faster startup times
   â€¢ 68% cost reduction ($205/month vs $650/month)
   â€¢ Optimized resource limits (512MB RAM vs 2GB)

  Container runtime: Docker
ğŸš€ Deploying Netra Apex Platform to GCP
   Project: netra-staging
   Region: us-central1
   Build Mode: Cloud Build
   Pre-checks: Disabled
   Config Validation: Enabled (default)

âœ… Phase 0: Validating Deployment Configuration...
   Checking against proven working configuration from netra-backend-staging-00035-fnj
Exception in thread Thread-9 (_readerthread):
Traceback (most recent call last):
  File "C:\Users\antho\miniconda3\Lib\threading.py", line 1073, in _bootstrap_inner
    self.run()
  File "C:\Users\antho\miniconda3\Lib\threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
  File "C:\Users\antho\miniconda3\Lib\subprocess.py", line 1599, in _readerthread
    buffer.append(fh.read())
                  ^^^^^^^^^
  File "C:\Users\antho\miniconda3\Lib\encodings\cp1252.py", line 23, in decode
    return codecs.charmap_decode(input,self.errors,decoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeDecodeError: 'charmap' codec can't decode byte 0x8d in position 309: character maps to <undefined>
   âœ… Configuration matches proven working setup

ğŸ” Phase 1: Validating Prerequisites...
âœ… gcloud CLI configured for project: netra-staging

ğŸ”§ Enabling required GCP APIs...
  Enabling run.googleapis.com...
  Enabling containerregistry.googleapis.com...
  Enabling cloudbuild.googleapis.com...
  Enabling secretmanager.googleapis.com...
  Enabling compute.googleapis.com...
âœ… All required APIs enabled

ğŸ” Phase 2: Validating Secrets Configuration...
Checking all required secrets in Secret Manager...
  âœ… Secret configured: service-secret-staging
  âœ… Secret configured: secret-key-staging
  âœ… Secret configured: oauth-hmac-secret-staging
  âœ… Secret configured: postgres-password-staging
  âœ… Secret configured: postgres-port-staging
  âœ… Secret configured: jwt-secret-staging
  âœ… Secret configured: postgres-user-staging
  âœ… Secret configured: openai-api-key-staging
  âœ… Secret configured: service-id-staging
  âœ… Secret configured: postgres-db-staging
  âœ… Secret configured: gemini-api-key-staging
  âœ… Secret configured: postgres-host-staging
  âœ… Secret configured: google-oauth-client-secret-staging
  âœ… Secret configured: google-oauth-client-id-staging
  âœ… Secret configured: fernet-key-staging
  âœ… Secret configured: redis-url-staging
  âœ… Secret configured: jwt-secret-key-staging
  âœ… Secret configured: redis-password-staging
  âœ… Secret configured: clickhouse-password-staging

âœ… All required secrets are configured

ğŸ—ï¸ Phase 4: Building and Deploying Services...
   All prerequisites validated - proceeding with deployment

   Building backend...

ğŸ”¨ Building backend Docker image with Cloud Build...
  Using existing docker/backend.staging.alpine.Dockerfile
  Building image: gcr.io/netra-staging/netra-backend-staging:latest
  Note: Cloud Build is slower. Use --build-local for faster builds.
Creating temporary archive of 6150 file(s) totalling 108.8 MiB before compression.
Uploading tarball of [.] to [gs://netra-staging_cloudbuild/source/1757223751.746216-143ebfea06db434fbb398c7b4d6842b1.tgz]
Created [https://cloudbuild.googleapis.com/v1/projects/netra-staging/locations/global/builds/e9760283-8942-4bf3-af0b-b3d907a72577].
Logs are available at [ https://console.cloud.google.com/cloud-build/builds/e9760283-8942-4bf3-af0b-b3d907a72577?project=701982941522 ].

gcloud builds submit only displays logs from Cloud Storage. To view logs from Cloud Logging, run:
gcloud beta builds submit

Waiting for build to complete. Polling interval: 1 second(s).
ID                                    CREATE_TIME                DURATION  SOURCE                                                                                       IMAGES  STATUS
e9760283-8942-4bf3-af0b-b3d907a72577  2025-09-07T05:42:59+00:00  3M4S      gs://netra-staging_cloudbuild/source/1757223751.746216-143ebfea06db434fbb398c7b4d6842b1.tgz  -       SUCCESS
âœ… backend image built successfully
   Deploying backend...

ğŸš€ Deploying backend to Cloud Run...
      â„¹ï¸ Database URL will be built from POSTGRES_* variables by DatabaseURLBuilder
âœ… backend deployed successfully
  ğŸ“¡ Updating traffic to latest revision for netra-backend-staging...
  â³ Waiting for netra-backend-staging revision to be ready...
  âœ… Revision is ready
  âœ… Traffic updated to latest revision

   Building auth...

ğŸ”¨ Building auth Docker image with Cloud Build...
  Using existing docker/auth.staging.alpine.Dockerfile
  Building image: gcr.io/netra-staging/netra-auth-service:latest
  Note: Cloud Build is slower. Use --build-local for faster builds.
Creating temporary archive of 6150 file(s) totalling 108.8 MiB before compression.
Uploading tarball of [.] to [gs://netra-staging_cloudbuild/source/1757224087.710291-f127bb0a624e45c3a5e6804b5fc95bdb.tgz]
Created [https://cloudbuild.googleapis.com/v1/projects/netra-staging/locations/global/builds/ea76077a-2ad1-4b0b-8fc7-af46b8170db1].
Logs are available at [ https://console.cloud.google.com/cloud-build/builds/ea76077a-2ad1-4b0b-8fc7-af46b8170db1?project=701982941522 ].

gcloud builds submit only displays logs from Cloud Storage. To view logs from Cloud Logging, run:
gcloud beta builds submit

Waiting for build to complete. Polling interval: 1 second(s).
ID                                    CREATE_TIME                DURATION  SOURCE                                                                                       IMAGES  STATUS
ea76077a-2ad1-4b0b-8fc7-af46b8170db1  2025-09-07T05:48:35+00:00  1M37S     gs://netra-staging_cloudbuild/source/1757224087.710291-f127bb0a624e45c3a5e6804b5fc95bdb.tgz  -       SUCCESS
âœ… auth image built successfully
   Deploying auth...

ğŸš€ Deploying auth to Cloud Run...
      â„¹ï¸ Database URL will be built from POSTGRES_* variables by DatabaseURLBuilder
