# Deployment Infrastructure Index

## Current Deployment Structure

After removing legacy deployment concepts, the current deployment infrastructure is organized as follows:

## 1. Local Development Infrastructure

### Terraform Configuration (`/terraform-dev-postgres/`)
**Purpose**: Local development environment setup using Docker containers

#### Core Infrastructure Files:
- `main.tf` - Main Terraform configuration
- `providers.tf` - Provider configurations (Docker, Random)
- `variables.tf` - Variable definitions
- `outputs.tf` - Output definitions for connection strings
- `outputs_files.tf` - File outputs for environment configurations

#### Service Configurations:
- `postgres.tf` - PostgreSQL database container
- `redis.tf` - Redis cache container
- `clickhouse.tf` - ClickHouse analytics database container
- `network.tf` - Docker network configuration
- `passwords.tf` - Secure password generation

#### Management Scripts:
- `quick-start.sh` / `quick-start.ps1` - One-command setup scripts
- `manage.sh` / `manage.ps1` - Infrastructure management utilities
- `init-scripts/01-init-database.sql` - Database initialization

#### Templates:
- `templates/env.development.tpl` - Development environment template

## 2. Development Launcher

### Location: `/scripts/dev_launcher.py`
**Purpose**: Unified development environment launcher
- Starts all services in correct order
- Manages health checks
- Handles graceful shutdown

## 3. Configuration Files

### Environment Configurations:
- `.env` files removed (as per legacy cleanup)
- Configuration now managed through:
  - `config/config.yaml` - Main configuration
  - `config/staging.env` - Staging environment variables
  - Generated files from Terraform

### Test Configurations:
- `config/pytest.ini` - Pytest configuration
- `config/test_config_unified.ini` - Unified test configuration

## 4. GitHub Actions Workflows

### Active Workflows (`/.github/workflows/`):
- `unified-test-runner.yml` - Main test orchestration
- `master-orchestrator.yml` - CI/CD orchestration
- `e2e-tests.yml` - End-to-end testing
- `architecture-compliance.yml` - Architecture validation
- `code-quality.yml` - Code quality checks
- `frontend-tests.yml` - Frontend testing
- `security-scan.yml` - Security scanning

### Removed Workflows:
- ❌ `deploy-production.yml` (removed)
- ❌ `deploy-auth-service.yml` (removed)
- ❌ `ci-cd-pipeline.yml` (removed)

## 5. Specifications and Documentation

### Active Specs (`/SPEC/`):
- `terraform_gcp.xml` - Terraform GCP patterns
- `service_naming_conventions.xml` - Service naming learnings
- `learnings/terraform_database_configuration_fix.xml` - Database config learnings

### Removed Specs:
- ❌ `gcp_deployment.xml` (removed)
- ❌ `learnings/deployment_staging.xml` (removed)
- ❌ `cloud-run-*.xml` (removed)
- ❌ `learnings/infrastructure_cloud_run.xml` (removed)

## 6. Service Architecture

### Microservices:
1. **Main Backend** (`/netra_backend/`)
   - Port: 8888
   - FastAPI application
   
2. **Auth Service** (`/auth_service/`)
   - Port: 8001
   - OAuth2/JWT authentication
   
3. **Frontend** (`/frontend/`)
   - Port: 3000
   - Next.js application

### Infrastructure Services:
1. **PostgreSQL**
   - Port: 5432
   - Main database
   
2. **Redis**
   - Port: 6379
   - Caching and session storage
   
3. **ClickHouse**
   - Port: 8123
   - Analytics database

## 7. Removed Legacy Components

### Completely Removed:
- `/organized_root/deployment_configs/` - All deployment scripts and configs
- `/organized_root/docker_configs/` - Dockerfiles moved to service directories
- `/config/cloudbuild*.yaml` - Google Cloud Build files
- `/config/docker-compose.staging.yml` - Staging compose file
- All deployment-related Python scripts in `/scripts/`
- Cloud Run specific files and configurations

## 8. Current Deployment Strategy

### Local Development:
1. Use Terraform to provision local Docker containers
2. Run `python scripts/dev_launcher.py` to start services
3. Services communicate via Docker network

### Testing:
1. GitHub Actions for CI/CD
2. Unified test runner for all test levels
3. No staging/production deployment automation

### Production Deployment:
- **Status**: No automated deployment pipeline
- **Recommendation**: Deployment should be handled externally or rebuilt when needed

## 9. Key Learnings Preserved

### Service Naming:
- Consistent snake_case for service names
- Service URLs follow pattern: `{SERVICE_NAME}_URL`

### Port Conventions:
- Backend: 8888
- Auth: 8001
- Frontend: 3000
- Postgres: 5432
- Redis: 6379
- ClickHouse: 8123

### Configuration:
- Environment-specific configs generated by Terraform
- No hardcoded secrets or deployment configs
- Clean separation between dev and prod concerns

## 10. Next Steps for Deployment

If deployment automation is needed in the future:
1. Create new deployment strategy based on current requirements
2. Consider containerization with proper multi-stage builds
3. Implement Infrastructure as Code for cloud resources
4. Set up proper CI/CD pipeline with environment promotion
5. Ensure security best practices (secrets management, RBAC, etc.)