# SSOT Legacy Code Remediation: Environment Variable Access

**Issue**: [#596 SSOT-incomplete-migration-environment-variable-access](https://github.com/netra-systems/netra-apex/issues/596)
**Priority**: P0 CRITICAL - Blocks Golden Path
**Created**: 2025-09-12
**Status**: IN PROGRESS

## VIOLATION SUMMARY
Direct `os.environ` and `os.getenv()` calls throughout core infrastructure instead of SSOT `IsolatedEnvironment` pattern.

## CRITICAL FILES AFFECTED
- ‚úã **CRITICAL**: `netra_backend/app/core/auth_startup_validator.py` (Lines 507-516) - **BLOCKS JWT validation**
- ‚ö†Ô∏è **HIGH**: `netra_backend/app/core/configuration/unified_secrets.py` (Lines 52, 69)
- ‚ö†Ô∏è **MEDIUM**: `netra_backend/app/admin/corpus/unified_corpus_admin.py` (Lines 155, 281)

## GOLDEN PATH IMPACT
- **EXTREME** - Auth startup validation uses direct os.environ fallback
- Causes JWT secret mismatches preventing user login  
- Creates race conditions in Cloud Run environment initialization
- **BLOCKS**: Users login ‚Üí get AI responses flow

## VIOLATION PATTERNS DISCOVERED

### Legacy Pattern (VIOLATION):
```python
# Direct os.environ access
direct_value = os.environ.get(var_name)
env_specific_value = self.env.get(env_specific) or os.environ.get(env_specific)
fallback = os.getenv('JWT_SECRET_KEY', 'default')
```

### SSOT Pattern (TARGET):
```python
# Use IsolatedEnvironment SSOT
from shared.isolated_environment import get_env
env = get_env()
value = env.get(var_name)
```

## REMEDIATION PROCESS STATUS

### ‚úÖ COMPLETED
- [x] **Step 0**: SSOT Audit completed - Top 3 violations identified
- [x] **Issue Creation**: GitHub issue #596 created
- [x] **Local Tracking**: .md file created

### üîÑ IN PROGRESS
- [ ] **Step 1**: Discover and plan tests
- [ ] **Step 2**: Execute test plan (20% new SSOT tests)
- [ ] **Step 3**: Plan SSOT remediation
- [ ] **Step 4**: Execute remediation plan
- [ ] **Step 5**: Test fix loop until all tests pass
- [ ] **Step 6**: PR creation and closure

## TEST DISCOVERY PLAN
Need to find existing tests protecting:
- Auth startup validation flow
- JWT secret handling across environments
- Environment variable access patterns
- Golden Path authentication integration

## SUCCESS CRITERIA
- [ ] All direct os.environ access replaced with IsolatedEnvironment SSOT
- [ ] JWT validation works consistently across all environments  
- [ ] Auth startup validator passes without fallback patterns
- [ ] Golden Path login flow functional
- [ ] All existing tests continue to pass
- [ ] New SSOT validation tests added and passing

## BUSINESS IMPACT
**Revenue Protection**: Blocks $500K+ ARR Golden Path user authentication flow

---
*Generated by SSOT Gardener Process | Last Updated: 2025-09-12*