# CI Environment Configuration
# Used with docker-compose.unified.yml for CI/CD pipelines
# Activate with: COMPOSE_PROFILES=ci docker-compose -f docker-compose.unified.yml --env-file .env.ci up

# Environment
BUILD_ENV=ci
ENVIRONMENT=ci
NODE_ENV=production
LOG_LEVEL=ERROR

# Docker Images
BACKEND_IMAGE=netra-ci-backend:latest
AUTH_IMAGE=netra-ci-auth:latest
FRONTEND_IMAGE=netra-ci-frontend:latest
BACKEND_DOCKERFILE=./docker/backend.alpine.Dockerfile
AUTH_DOCKERFILE=./docker/auth.alpine.Dockerfile
FRONTEND_DOCKERFILE=./docker/frontend.alpine.Dockerfile

# Service Names (for dependency resolution)
POSTGRES_HOST=ci-postgres
REDIS_HOST=ci-redis
CLICKHOUSE_HOST=ci-clickhouse
AUTH_SERVICE_URL=http://ci-auth:8081

# Database Configuration (Optimized for CI speed)
POSTGRES_USER=ci
POSTGRES_PASSWORD=ci
POSTGRES_DB=netra_ci
POSTGRES_AUTH_METHOD=trust
POSTGRES_FSYNC=off
POSTGRES_SYNC_COMMIT=off
POSTGRES_FULL_PAGE_WRITES=off

# Redis Configuration (Minimal for CI)
REDIS_AOF=no
REDIS_SAVE=
REDIS_MAX_MEMORY=128mb
REDIS_POLICY=allkeys-lru

# ClickHouse Configuration
CLICKHOUSE_USER=ci
CLICKHOUSE_PASSWORD=ci
CLICKHOUSE_DB=ci_analytics
CLICKHOUSE_PORT=9000
CLICKHOUSE_LOG_LEVEL=error

# Port Allocation (CI - Unique to avoid conflicts)
CI_POSTGRES_PORT=5436
CI_REDIS_PORT=6383
CI_CLICKHOUSE_HTTP_PORT=8127
CI_CLICKHOUSE_TCP_PORT=9004
CI_BACKEND_PORT=8003
CI_AUTH_PORT=8084
CI_FRONTEND_PORT=3003

# Resource Limits (CI - Optimized for speed)
CI_POSTGRES_MEMORY=512M
CI_POSTGRES_CPU=0.5
CI_REDIS_MEMORY=256M
CI_REDIS_CPU=0.25
CI_CLICKHOUSE_MEMORY=512M
CI_CLICKHOUSE_CPU=0.5
CI_BACKEND_MEMORY=2G
CI_BACKEND_CPU=1.0
CI_AUTH_MEMORY=1G
CI_AUTH_CPU=0.5
CI_FRONTEND_MEMORY=1G
CI_FRONTEND_CPU=0.5

# Health Check Configuration (Fast for CI)
HEALTH_CHECK_INTERVAL=5s
HEALTH_CHECK_TIMEOUT=3s
HEALTH_CHECK_RETRIES=15
HEALTH_CHECK_START_PERIOD=15s

# Application Secrets (CI Only - Generated per build)
JWT_SECRET_KEY=ci_jwt_secret_key_${CI_BUILD_ID:-default}
SERVICE_SECRET=ci_service_secret_${CI_BUILD_ID:-default}
FERNET_KEY=ci_fernet_key_for_ci_only_must_be_32chars
SECRET_KEY=ci_secret_key_${CI_BUILD_ID:-default}
AUTH_SERVICE_ID=ci-auth-service

# Frontend Configuration
NEXT_PUBLIC_API_URL=http://ci-backend:8000
NEXT_PUBLIC_AUTH_URL=http://ci-auth:8081
NEXT_PUBLIC_WS_URL=ws://ci-backend:8000

# Backend Configuration
BACKEND_WORKERS=2
WEB_CONCURRENCY=2
ENABLE_MEMORY_MONITORING=false
MEMORY_CHECK_INTERVAL=60
MEMORY_WARNING_THRESHOLD=95
MEMORY_CRITICAL_THRESHOLD=98

# CI Mode Settings
TEST_MODE=true
TESTING=1
CI_MODE=true
AUTH_FAST_TEST_MODE=true

# Python Optimizations
PYTHONOPTIMIZE=2
PYTHONDONTWRITEBYTECODE=1

# Node Optimizations
NODE_OPTIONS=--max-old-space-size=512