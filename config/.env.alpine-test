# Alpine Test Environment Configuration
# Used with docker-compose.unified.yml for Alpine-optimized testing
# Activate with: COMPOSE_PROFILES=alpine-test docker-compose -f docker-compose.unified.yml --env-file .env.alpine-test up

# Environment
BUILD_ENV=test
ENVIRONMENT=alpine-test
NODE_ENV=test
LOG_LEVEL=ERROR

# Docker Images (Alpine-based)
BACKEND_IMAGE=netra-alpine-test-backend:latest
AUTH_IMAGE=netra-alpine-test-auth:latest
FRONTEND_IMAGE=netra-alpine-test-frontend:latest
BACKEND_DOCKERFILE=./docker/backend.alpine.Dockerfile
AUTH_DOCKERFILE=./docker/auth.alpine.Dockerfile
FRONTEND_DOCKERFILE=./docker/frontend.alpine.Dockerfile

# Service Names (for dependency resolution)
POSTGRES_HOST=alpine-test-postgres
REDIS_HOST=alpine-test-redis
CLICKHOUSE_HOST=alpine-test-clickhouse
AUTH_SERVICE_URL=http://alpine-test-auth:8081

# Database Configuration (Optimized for speed)
POSTGRES_USER=test
POSTGRES_PASSWORD=test
POSTGRES_DB=netra_test
POSTGRES_AUTH_METHOD=trust
POSTGRES_FSYNC=off
POSTGRES_SYNC_COMMIT=off
POSTGRES_FULL_PAGE_WRITES=off

# Redis Configuration (Minimal)
REDIS_AOF=no
REDIS_SAVE=
REDIS_MAX_MEMORY=200mb
REDIS_POLICY=allkeys-lru

# ClickHouse Configuration
CLICKHOUSE_USER=test
CLICKHOUSE_PASSWORD=test
CLICKHOUSE_DB=test_analytics
CLICKHOUSE_PORT=9000
CLICKHOUSE_LOG_LEVEL=error

# Port Allocation (Alpine Test)
ALPINE_TEST_POSTGRES_PORT=5435
ALPINE_TEST_REDIS_PORT=6382
ALPINE_TEST_CLICKHOUSE_HTTP_PORT=8126
ALPINE_TEST_CLICKHOUSE_TCP_PORT=9003
ALPINE_TEST_BACKEND_PORT=8002
ALPINE_TEST_AUTH_PORT=8083
ALPINE_TEST_FRONTEND_PORT=3002

# Resource Limits (Alpine Optimized)
ALPINE_TEST_POSTGRES_MEMORY=1G
ALPINE_TEST_POSTGRES_CPU=0.5
ALPINE_TEST_REDIS_MEMORY=512M
ALPINE_TEST_REDIS_CPU=0.25
ALPINE_TEST_CLICKHOUSE_MEMORY=1G
ALPINE_TEST_CLICKHOUSE_CPU=0.5
ALPINE_TEST_BACKEND_MEMORY=2G
ALPINE_TEST_BACKEND_CPU=1.0
ALPINE_TEST_AUTH_MEMORY=2G
ALPINE_TEST_AUTH_CPU=1.0
ALPINE_TEST_FRONTEND_MEMORY=512M
ALPINE_TEST_FRONTEND_CPU=0.3

# Health Check Configuration (Fast)
HEALTH_CHECK_INTERVAL=5s
HEALTH_CHECK_TIMEOUT=3s
HEALTH_CHECK_RETRIES=15
HEALTH_CHECK_START_PERIOD=30s

# Application Secrets (Test Only)
JWT_SECRET_KEY=rsWwwvq8X6mCSuNv-TMXHDCfb96Xc-Dbay9MZy6EDCU
SERVICE_SECRET=test_service_secret
FERNET_KEY=hMT-Xu0HfnNhKf-J5sKXMJLnCfCiSUQnVdE1yc6Xqzg=
SECRET_KEY=test_secret_key_for_alpine_testing
AUTH_SERVICE_ID=alpine-test-auth-service

# Frontend Configuration
NEXT_PUBLIC_API_URL=http://alpine-test-backend:8000
NEXT_PUBLIC_AUTH_URL=http://alpine-test-auth:8081
NEXT_PUBLIC_WS_URL=ws://alpine-test-backend:8000

# Backend Configuration (Optimized)
BACKEND_WORKERS=2
WEB_CONCURRENCY=2
ENABLE_MEMORY_MONITORING=false
MEMORY_CHECK_INTERVAL=60
MEMORY_WARNING_THRESHOLD=90
MEMORY_CRITICAL_THRESHOLD=95

# Alpine Optimizations
PYTHONOPTIMIZE=2
PYTHONDONTWRITEBYTECODE=1
NODE_OPTIONS=--max-old-space-size=200

# Test Mode Settings
TEST_MODE=true
TESTING=1
CLICKHOUSE_MOCK_MODE=true
AUTH_FAST_TEST_MODE=true